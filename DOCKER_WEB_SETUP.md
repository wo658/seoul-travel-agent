# ğŸ³ Docker ê¸°ë°˜ ì›¹ ë·° í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

React Native ì•±ì„ Docker í™˜ê²½ì—ì„œ ì›¹ ë¸Œë¼ìš°ì €ë¡œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

## ğŸ“‹ ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- Docker Desktop ì„¤ì¹˜
- Docker Compose ì„¤ì¹˜
- OpenAI API Key (ì„ íƒì‚¬í•­)

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

**ë°±ì—”ë“œ í™˜ê²½ ë³€ìˆ˜** (`.env.docker` ì´ë¯¸ ì¡´ì¬):
```bash
# backend/.env.docker íŒŒì¼ í™•ì¸
cat backend/.env.docker
```

í•„ìš”ì‹œ OpenAI API Key ì¶”ê°€:
```bash
# backend/.env.docker ìˆ˜ì •
OPENAI_API_KEY=your-api-key-here
```

**í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ ë³€ìˆ˜** (ìë™ ì„¤ì •ë¨):
```yaml
# docker-compose.ymlì— ì´ë¯¸ ì„¤ì •ë¨
environment:
  - EXPO_PUBLIC_API_URL=http://localhost:8000
```

### 2. Docker ë¹Œë“œ ë° ì‹¤í–‰

```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰
make build    # Docker ì´ë¯¸ì§€ ë¹Œë“œ (ì²˜ìŒ í•œ ë²ˆë§Œ)
make up       # ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘
```

ë˜ëŠ” ì§ì ‘ docker-compose ì‚¬ìš©:
```bash
docker-compose build
docker-compose up -d
```

### 3. ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†

ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ë©´ ë‹¤ìŒ URLë¡œ ì ‘ì†:

- **Frontend (ì›¹ì•±)**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API ë¬¸ì„œ**: http://localhost:8000/api/docs

## ğŸ”§ ì£¼ìš” ëª…ë ¹ì–´

### ì„œë¹„ìŠ¤ ê´€ë¦¬

```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹œì‘
make up

# ë¡œê·¸ í™•ì¸ (ì‹¤ì‹œê°„)
make logs

# ë°±ì—”ë“œ ë¡œê·¸ë§Œ í™•ì¸
make logs-backend

# í”„ë¡ íŠ¸ì—”ë“œ ë¡œê·¸ë§Œ í™•ì¸
make logs-frontend

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
make ps

# ì„œë¹„ìŠ¤ ì¤‘ì§€
make down

# ì¬ì‹œì‘
make restart
```

### ê°œë°œ ì›Œí¬í”Œë¡œìš°

```bash
# ì½”ë“œ ìˆ˜ì • í›„ ìë™ ë¦¬ë¡œë“œ (Hot Reload)
# - ë°±ì—”ë“œ: uvicorn --reload ì˜µì…˜ìœ¼ë¡œ ìë™ ë¦¬ë¡œë“œ
# - í”„ë¡ íŠ¸ì—”ë“œ: Expo ê°œë°œ ì„œë²„ê°€ ìë™ ë¦¬ë¡œë“œ

# ë³€ê²½ì‚¬í•­ í™•ì¸
make logs-frontend
```

### ë””ë²„ê¹…

```bash
# ë°±ì—”ë“œ ì»¨í…Œì´ë„ˆ ì ‘ì†
make backend-shell
# ë˜ëŠ”
docker-compose exec backend bash

# ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì†
make db-shell
# ë˜ëŠ”
docker-compose exec db psql -U postgres -d seoul_travel

# í”„ë¡ íŠ¸ì—”ë“œ ì»¨í…Œì´ë„ˆ ì ‘ì†
docker-compose exec frontend sh
```

## ğŸŒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±

Docker Composeê°€ ìë™ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host Machine (localhost)               â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Frontend Container              â”‚   â”‚
â”‚  â”‚ - Expo Web Server               â”‚   â”‚
â”‚  â”‚ - Port: 3000                    â”‚   â”‚
â”‚  â”‚ - API URL: http://backend:8000  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Backend Container               â”‚   â”‚
â”‚  â”‚ - FastAPI Server                â”‚   â”‚
â”‚  â”‚ - Port: 8000                    â”‚   â”‚
â”‚  â”‚ - DB: postgresql://db:5432      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â†“                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ PostgreSQL Container            â”‚   â”‚
â”‚  â”‚ - Port: 5432                    â”‚   â”‚
â”‚  â”‚ - Volume: postgres_data         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš ï¸ ì¤‘ìš”: ë¸Œë¼ìš°ì €ì—ì„œ API í˜¸ì¶œ ì´ìŠˆ

### ë¬¸ì œ
Frontend ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œëŠ” `http://backend:8000`ë¡œ í†µì‹ í•˜ì§€ë§Œ,
ë¸Œë¼ìš°ì €(í´ë¼ì´ì–¸íŠ¸)ì—ì„œëŠ” `http://localhost:8000`ë¡œ í†µì‹ í•´ì•¼ í•©ë‹ˆë‹¤.

### í•´ê²° ë°©ë²•

**ì˜µì…˜ 1: í™˜ê²½ ë³€ìˆ˜ ìˆ˜ì • (ê¶Œì¥)**

`docker-compose.yml` ìˆ˜ì •:
```yaml
frontend:
  environment:
    - EXPO_PUBLIC_API_URL=http://localhost:8000  # backend â†’ localhost ë³€ê²½
```

**ì˜µì…˜ 2: CORS ì„¤ì • í™•ì¸**

ë°±ì—”ë“œ `.env.docker`ì—ì„œ CORS ì„¤ì • í™•ì¸:
```bash
CORS_ORIGINS=["http://localhost:3000","http://localhost:8081"]
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. í™ˆ í™”ë©´ í…ŒìŠ¤íŠ¸
1. http://localhost:3000 ì ‘ì†
2. "ìƒˆ ëŒ€í™” ì‹œì‘" ë²„íŠ¼ í™•ì¸
3. "ëŒ€í™” ëª©ë¡" ë²„íŠ¼ í™•ì¸

### 2. ì±„íŒ… ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
1. "ìƒˆ ëŒ€í™” ì‹œì‘" í´ë¦­
2. ë©”ì‹œì§€ ì…ë ¥: "3ì¼ê°„ ì„œìš¸ ì—¬í–‰ ê³„íš ë„ì™€ì¤˜"
3. ì „ì†¡ ë²„íŠ¼ í´ë¦­
4. AI ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° í™•ì¸

### 3. API ì§ì ‘ í…ŒìŠ¤íŠ¸
```bash
# ëŒ€í™” ìƒì„±
curl -X POST http://localhost:8000/api/ai/conversations \
  -H "Content-Type: application/json" \
  -d '{"initial_message": "ì„œìš¸ ì—¬í–‰ ê³„íš"}'

# API ë¬¸ì„œ í™•ì¸
open http://localhost:8000/api/docs
```

## ğŸ” ë¬¸ì œ í•´ê²°

### Frontendê°€ Backendì— ì—°ê²°ë˜ì§€ ì•ŠëŠ” ê²½ìš°

1. **CORS ì—ëŸ¬ í™•ì¸**:
```bash
# ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
make logs-backend
```

2. **ë„¤íŠ¸ì›Œí¬ í™•ì¸**:
```bash
# ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  í…ŒìŠ¤íŠ¸
docker-compose exec frontend wget -O- http://backend:8000/health
```

3. **í™˜ê²½ ë³€ìˆ˜ í™•ì¸**:
```bash
docker-compose exec frontend env | grep API_URL
```

### í¬íŠ¸ ì¶©ëŒ í•´ê²°

í¬íŠ¸ê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ê²½ìš°:
```bash
# í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof -i :3000
lsof -i :8000
lsof -i :5432

# docker-compose.ymlì—ì„œ í¬íŠ¸ ë³€ê²½
ports:
  - "3001:3000"  # 3000 â†’ 3001ë¡œ ë³€ê²½
```

### ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ë³¼ë¥¨ ì‚­ì œ ë° ì¬ìƒì„±
make clean-db
make up
```

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### ê°œë°œ í™˜ê²½ ìµœì í™”

```yaml
# docker-compose.yml
frontend:
  volumes:
    - ./frontend:/app
    - /app/node_modules  # node_modules ìºì‹œ
    - /app/.expo         # Expo ìºì‹œ
```

### ë¹Œë“œ ìºì‹œ í™œìš©

```bash
# ìºì‹œ í™œìš©í•˜ì—¬ ë¹Œë“œ
docker-compose build --parallel

# ìºì‹œ ì—†ì´ ë¹Œë“œ (ë¬¸ì œ ë°œìƒ ì‹œ)
docker-compose build --no-cache
```

## ğŸ§¹ ì •ë¦¬

### ê°œë°œ ì¢…ë£Œ ì‹œ

```bash
# ì»¨í…Œì´ë„ˆë§Œ ì¤‘ì§€
make down

# ì»¨í…Œì´ë„ˆ + ë³¼ë¥¨ ì‚­ì œ
make clean

# ëª¨ë“  Docker ë¦¬ì†ŒìŠ¤ ì •ë¦¬
docker system prune -a
```

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. **ë°±ì—”ë“œ API êµ¬í˜„**:
   - `/api/ai/conversations` ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
   - SSE ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„
   - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

2. **í”„ë¡ íŠ¸ì—”ë“œ ê°œì„ **:
   - SSE ë¼ì´ë¸ŒëŸ¬ë¦¬ í†µí•© (`react-native-sse`)
   - ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
   - ë¡œë”© ìƒíƒœ ê°œì„ 

3. **ë°°í¬ ì¤€ë¹„**:
   - í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •
   - í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
   - CI/CD íŒŒì´í”„ë¼ì¸

## ğŸ”— ìœ ìš©í•œ ë§í¬

- [Docker Compose ë¬¸ì„œ](https://docs.docker.com/compose/)
- [Expo Web ë¬¸ì„œ](https://docs.expo.dev/guides/web/)
- [FastAPI ë¬¸ì„œ](https://fastapi.tiangolo.com/)
